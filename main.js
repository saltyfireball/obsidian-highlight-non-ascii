/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var x=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var F=Object.prototype.hasOwnProperty;var I=(n,i)=>{for(var s in i)x(n,s,{get:i[s],enumerable:!0})},L=(n,i,s,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let t of k(i))!F.call(n,t)&&t!==s&&x(n,t,{get:()=>i[t],enumerable:!(e=H(i,t))||e.enumerable});return n};var M=n=>L(x({},"__esModule",{value:!0}),n);var j={};I(j,{default:()=>E});module.exports=M(j);var r=require("obsidian"),d=require("@codemirror/view"),h=require("@codemirror/state"),U={enabled:!0,allowedChars:"",customCSS:""};function v(n){let i=new Set;for(let s of Array.from(n))s.trim()===""&&s!=="\xA0"||i.add(s);return i}function w(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var y=h.StateEffect.define(),A=h.StateEffect.define();function O(n){let i=h.StateField.define({create(){return{enabled:n.settings.enabled,allowedSet:v(n.settings.allowedChars)}},update(e,t){let o=e;for(let a of t.effects)a.is(y)&&(o={...o,enabled:a.value}),a.is(A)&&(o={...o,allowedSet:v(a.value)});return o}}),s=d.ViewPlugin.fromClass(class{constructor(e){this.decorations=this.buildDecorations(e)}update(e){(e.docChanged||e.viewportChanged||e.transactions.some(t=>t.effects.some(o=>o.is(y)||o.is(A))))&&(this.decorations=this.buildDecorations(e.view))}buildDecorations(e){let{enabled:t,allowedSet:o}=e.state.field(i);if(!t)return d.Decoration.none;let a=new h.RangeSetBuilder,c=e.state.doc;for(let{from:l,to:g}of e.visibleRanges){let u=c.sliceString(l,g),p=0,f=l;for(let C of Array.from(u)){let S=C.length,N=C.codePointAt(0);if(N!==void 0&&N>127&&!o.has(C)){let m=f+S,V=Array.from(u.slice(p+S));for(let b of V){let P=b.codePointAt(0);if(P!==void 0&&P>127&&!o.has(b))m+=b.length;else break}a.add(f,m,d.Decoration.mark({class:"non-ascii-highlight"}));let D=m-f;p+=D,f=m;continue}p+=S,f+=S}}return a.finish()}},{decorations:e=>e.decorations});return[i,s]}function R(n,i){let s=[],e=document.createTreeWalker(n,NodeFilter.SHOW_TEXT);for(;e.nextNode();){let t=e.currentNode;t.textContent&&/[^\x00-\x7F]/.test(t.textContent)&&s.push(t)}s.forEach(t=>{let o=document.createElement("span"),a="",c=!1,l="";for(let g of Array.from(t.textContent||"")){let u=g.codePointAt(0);u!==void 0&&u>127&&!i.has(g)?(c||(a+=w(l),l="",c=!0),l+=g):(c&&(a+=`<span class="non-ascii-highlight">${w(l)}</span>`,l="",c=!1),l+=g)}c?a+=`<span class="non-ascii-highlight">${w(l)}</span>`:a+=w(l),o.innerHTML=a,t.parentNode&&t.parentNode.replaceChild(o,t)})}var T=class extends r.PluginSettingTab{constructor(i,s){super(i,s),this.plugin=s}display(){let{containerEl:i}=this;i.empty(),i.createEl("h2",{text:"Highlight Non-ASCII"}),i.createEl("p",{text:"Highlights any character outside the standard ASCII range (0x00-0x7F) in both Edit Mode (Live Preview) and Reading View. Use the allowlist to exclude specific characters from highlighting.",cls:"setting-item-description"}),new r.Setting(i).setName("Enable highlighting").setDesc("Toggle non-ASCII character highlighting on or off.").addToggle(t=>t.setValue(this.plugin.settings.enabled).onChange(async o=>{this.plugin.settings.enabled=o,await this.plugin.saveSettings(),this.plugin.refreshAllEditors()})),new r.Setting(i).setName("Allowed characters").setDesc("Paste characters or emojis here that should NOT be highlighted. Just paste them next to each other, no separators needed. Example: e--n").addTextArea(t=>{t.setPlaceholder("e.g. e--n").setValue(this.plugin.settings.allowedChars).onChange(async o=>{this.plugin.settings.allowedChars=o,await this.plugin.saveSettings(),this.plugin.refreshAllEditors()}),t.inputEl.rows=3,t.inputEl.cols=40,t.inputEl.style.fontFamily="monospace"}),new r.Setting(i).setName("Custom CSS").setDesc("Override the default highlight style. Use the .non-ascii-highlight selector to customize background-color, border, padding, border-radius, etc.");let e=i.createDiv("hna-css-editor").createEl("textarea",{cls:"hna-css-textarea"});e.value=this.plugin.settings.customCSS||"",e.placeholder=`.non-ascii-highlight {
  background-color: rgba(255, 60, 60, 1);
  padding: 1px;
  border: 1px solid rgb(255, 255, 255);
  border-radius: 2px;
}`,e.rows=8,e.spellcheck=!1,e.addEventListener("change",async()=>{this.plugin.settings.customCSS=e.value,await this.plugin.saveSettings(),this.plugin.updateCustomCSS()})}},E=class extends r.Plugin{constructor(){super(...arguments);this.customStyleEl=null}async onload(){await this.loadSettings(),this.customStyleEl=document.createElement("style"),this.customStyleEl.id="highlight-non-ascii-custom-css",document.head.appendChild(this.customStyleEl),this.updateCustomCSS(),this.editorExtension=O(this),this.registerEditorExtension(this.editorExtension),this.registerMarkdownPostProcessor(s=>{if(this.settings.enabled){let e=v(this.settings.allowedChars);R(s,e)}}),this.addSettingTab(new T(this.app,this)),this.addCommand({id:"toggle-non-ascii-highlight",name:"Toggle non-ASCII highlighting",callback:async()=>{this.settings.enabled=!this.settings.enabled,await this.saveSettings(),this.refreshAllEditors()}})}onunload(){this.customStyleEl&&(this.customStyleEl.remove(),this.customStyleEl=null)}updateCustomCSS(){this.customStyleEl&&(this.customStyleEl.textContent=this.settings.customCSS||"")}async loadSettings(){this.settings=Object.assign({},U,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}refreshAllEditors(){this.app.workspace.iterateAllLeaves(s=>{let e=s.view;e!=null&&e.editor&&e.editor.cm instanceof d.EditorView&&e.editor.cm.dispatch({effects:[y.of(this.settings.enabled),A.of(this.settings.allowedChars)]})}),this.app.workspace.iterateAllLeaves(s=>{var t;let e=s.view;(t=e==null?void 0:e.previewMode)!=null&&t.rerender&&e.previewMode.rerender(!0)})}};
