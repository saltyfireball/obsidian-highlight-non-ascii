/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var y=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var M=(o,s)=>{for(var i in s)y(o,i,{get:s[i],enumerable:!0})},U=(o,s,i,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let e of B(s))!I.call(o,e)&&e!==i&&y(o,e,{get:()=>s[e],enumerable:!(t=L(s,e))||t.enumerable});return o};var O=o=>U(y({},"__esModule",{value:!0}),o);var Y={};M(Y,{default:()=>b});module.exports=O(Y);var c=require("obsidian"),g=require("@codemirror/view"),p=require("@codemirror/state"),N=`.non-ascii-highlight {
  background-color: rgba(255, 60, 60, 1);
  padding: 1px;
  border: 1px solid rgb(255, 255, 255);
  border-radius: 2px;
}`,R={enabled:!0,allowedChars:"",customCSS:N};function x(o){let s=new Set;for(let i of Array.from(o))i.trim()===""&&i!=="\xA0"||s.add(i);return s}function S(o){return o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var _="highlight-non-ascii",A=p.StateEffect.define(),F=p.StateEffect.define(),D=p.StateEffect.define();function W(o){let s=p.StateField.define({create(){return{enabled:o.settings.enabled,allowedSet:x(o.settings.allowedChars),frontmatterDisabled:o.isActiveFileDisabledByFrontmatter()}},update(t,e){let n=t;for(let a of e.effects)a.is(A)&&(n={...n,enabled:a.value}),a.is(F)&&(n={...n,allowedSet:x(a.value)}),a.is(D)&&(n={...n,frontmatterDisabled:a.value});return n}}),i=g.ViewPlugin.fromClass(class{constructor(t){this.decorations=this.buildDecorations(t)}update(t){(t.docChanged||t.viewportChanged||t.transactions.some(e=>e.effects.some(n=>n.is(A)||n.is(F)||n.is(D))))&&(this.decorations=this.buildDecorations(t.view))}buildDecorations(t){let{enabled:e,allowedSet:n,frontmatterDisabled:a}=t.state.field(s);if(!e||a)return g.Decoration.none;let d=new p.RangeSetBuilder,r=t.state.doc;for(let{from:l,to:h}of t.visibleRanges){let w=r.sliceString(l,h),E=0,u=l;for(let v of Array.from(w)){let f=v.length,k=v.codePointAt(0);if(k!==void 0&&k>127&&!n.has(v)){let m=u+f,V=Array.from(w.slice(E+f));for(let C of V){let P=C.codePointAt(0);if(P!==void 0&&P>127&&!n.has(C))m+=C.length;else break}d.add(u,m,g.Decoration.mark({class:"non-ascii-highlight"}));let H=m-u;E+=H,u=m;continue}E+=f,u+=f}}return d.finish()}},{decorations:t=>t.decorations});return[s,i]}function j(o,s){let i=[],t=document.createTreeWalker(o,NodeFilter.SHOW_TEXT);for(;t.nextNode();){let e=t.currentNode;e.textContent&&/[^\x00-\x7F]/.test(e.textContent)&&i.push(e)}i.forEach(e=>{let n=document.createElement("span"),a="",d=!1,r="";for(let l of Array.from(e.textContent||"")){let h=l.codePointAt(0);h!==void 0&&h>127&&!s.has(l)?(d||(a+=S(r),r="",d=!0),r+=l):(d&&(a+=`<span class="non-ascii-highlight">${S(r)}</span>`,r="",d=!1),r+=l)}d?a+=`<span class="non-ascii-highlight">${S(r)}</span>`:a+=S(r),n.innerHTML=a,e.parentNode&&e.parentNode.replaceChild(n,e)})}var T=class extends c.PluginSettingTab{constructor(s,i){super(s,i),this.plugin=i}display(){let{containerEl:s}=this;s.empty(),s.createEl("h2",{text:"Highlight Non-ASCII"}),s.createEl("p",{text:"Highlights any character outside the standard ASCII range (0x00-0x7F) in both Edit Mode (Live Preview) and Reading View. Use the allowlist to exclude specific characters from highlighting.",cls:"setting-item-description"});let i=s.createDiv("hna-frontmatter-hint");i.createEl("h3",{text:"Per-note control"}),i.createEl("p",{text:"You can disable highlighting for a specific note by adding the following to its frontmatter:"});let t=`---
highlight-non-ascii: false
---`,e=i.createDiv("hna-code-wrapper");e.createEl("pre").createEl("code",{text:t});let a=e.createEl("button",{text:"Copy",cls:"hna-copy-btn",attr:{type:"button","aria-label":"Copy to clipboard"}});a.addEventListener("click",()=>{navigator.clipboard.writeText(t),a.textContent="Copied!",setTimeout(()=>{a.textContent="Copy"},1500)}),i.createEl("p",{text:"If the property is missing or set to true, highlighting remains active (as long as the global toggle above is enabled).",cls:"setting-item-description"}),new c.Setting(s).setName("Enable highlighting").setDesc("Toggle non-ASCII character highlighting on or off.").addToggle(l=>l.setValue(this.plugin.settings.enabled).onChange(async h=>{this.plugin.settings.enabled=h,await this.plugin.saveSettings(),this.plugin.refreshAllEditors()})),new c.Setting(s).setName("Allowed characters").setDesc("Paste characters or emojis here that should NOT be highlighted. Just paste them next to each other, no separators needed. Example: e--n").addTextArea(l=>{l.setPlaceholder("e.g. e--n").setValue(this.plugin.settings.allowedChars).onChange(async h=>{this.plugin.settings.allowedChars=h,await this.plugin.saveSettings(),this.plugin.refreshAllEditors()}),l.inputEl.rows=3,l.inputEl.cols=40,l.inputEl.style.fontFamily="monospace"}),new c.Setting(s).setName("Custom CSS").setDesc("Override the default highlight style. Use the .non-ascii-highlight selector to customize background-color, border, padding, border-radius, etc.");let r=s.createDiv("hna-css-editor").createEl("textarea",{cls:"hna-css-textarea"});r.value=this.plugin.settings.customCSS||N,r.rows=8,r.spellcheck=!1,r.addEventListener("change",async()=>{this.plugin.settings.customCSS=r.value,await this.plugin.saveSettings(),this.plugin.updateCustomCSS()})}},b=class extends c.Plugin{constructor(){super(...arguments);this.customStyleEl=null}async onload(){await this.loadSettings(),this.customStyleEl=document.createElement("style"),this.customStyleEl.id="highlight-non-ascii-custom-css",document.head.appendChild(this.customStyleEl),this.updateCustomCSS(),this.editorExtension=W(this),this.registerEditorExtension(this.editorExtension),this.registerMarkdownPostProcessor((i,t)=>{if(!this.settings.enabled)return;if(t.sourcePath){let n=this.app.vault.getAbstractFileByPath(t.sourcePath);if(n instanceof c.TFile&&this.isFileDisabledByFrontmatter(n))return}let e=x(this.settings.allowedChars);j(i,e)}),this.addSettingTab(new T(this.app,this)),this.addCommand({id:"toggle-non-ascii-highlight",name:"Toggle non-ASCII highlighting",callback:async()=>{this.settings.enabled=!this.settings.enabled,await this.saveSettings(),this.refreshAllEditors()}}),this.registerEvent(this.app.metadataCache.on("changed",()=>{this.dispatchFrontmatterUpdate()})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.dispatchFrontmatterUpdate()}))}isFileDisabledByFrontmatter(i){var n;let t=this.app.metadataCache.getFileCache(i),e=(n=t==null?void 0:t.frontmatter)==null?void 0:n[_];return e===!1||e==="false"}isActiveFileDisabledByFrontmatter(){let i=this.app.workspace.getActiveViewOfType(c.MarkdownView);return i!=null&&i.file?this.isFileDisabledByFrontmatter(i.file):!1}dispatchFrontmatterUpdate(){let i=this.isActiveFileDisabledByFrontmatter();this.app.workspace.iterateAllLeaves(t=>{let e=t.view;e!=null&&e.editor&&e.editor.cm instanceof g.EditorView&&e.editor.cm.dispatch({effects:[D.of(i)]})})}onunload(){this.customStyleEl&&(this.customStyleEl.remove(),this.customStyleEl=null)}updateCustomCSS(){this.customStyleEl&&(this.customStyleEl.textContent=this.settings.customCSS||"")}async loadSettings(){this.settings=Object.assign({},R,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}refreshAllEditors(){this.app.workspace.iterateAllLeaves(i=>{let t=i.view;t!=null&&t.editor&&t.editor.cm instanceof g.EditorView&&t.editor.cm.dispatch({effects:[A.of(this.settings.enabled),F.of(this.settings.allowedChars)]})}),this.app.workspace.iterateAllLeaves(i=>{var e;let t=i.view;(e=t==null?void 0:t.previewMode)!=null&&e.rerender&&t.previewMode.rerender(!0)})}};
