/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var A=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var I=(n,t)=>{for(var e in t)A(n,e,{get:t[e],enumerable:!0})},L=(n,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of F(t))!k.call(n,s)&&s!==e&&A(n,s,{get:()=>t[s],enumerable:!(i=D(t,s))||i.enumerable});return n};var M=n=>L(A({},"__esModule",{value:!0}),n);var j={};I(j,{default:()=>E});module.exports=M(j);var d=require("obsidian"),c=require("@codemirror/view"),h=require("@codemirror/state"),R={enabled:!0,allowedChars:""};function C(n){let t=new Set;for(let e of Array.from(n))e.trim()===""&&e!=="\xA0"||t.add(e);return t}function S(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var v=h.StateEffect.define(),y=h.StateEffect.define();function U(n){let t=h.StateField.define({create(){return{enabled:n.settings.enabled,allowedSet:C(n.settings.allowedChars)}},update(i,s){let o=i;for(let a of s.effects)a.is(v)&&(o={...o,enabled:a.value}),a.is(y)&&(o={...o,allowedSet:C(a.value)});return o}}),e=c.ViewPlugin.fromClass(class{constructor(i){this.decorations=this.buildDecorations(i)}update(i){(i.docChanged||i.viewportChanged||i.transactions.some(s=>s.effects.some(o=>o.is(v)||o.is(y))))&&(this.decorations=this.buildDecorations(i.view))}buildDecorations(i){let{enabled:s,allowedSet:o}=i.state.field(t);if(!s)return c.Decoration.none;let a=new h.RangeSetBuilder,r=i.state.doc;for(let{from:l,to:g}of i.visibleRanges){let f=r.sliceString(l,g),p=0,u=l;for(let b of Array.from(f)){let w=b.length,N=b.codePointAt(0);if(N!==void 0&&N>127&&!o.has(b)){let m=u+w,V=Array.from(f.slice(p+w));for(let x of V){let T=x.codePointAt(0);if(T!==void 0&&T>127&&!o.has(x))m+=x.length;else break}a.add(u,m,c.Decoration.mark({class:"non-ascii-highlight"}));let H=m-u;p+=H,u=m;continue}p+=w,u+=w}}return a.finish()}},{decorations:i=>i.decorations});return[t,e]}function O(n,t){let e=[],i=document.createTreeWalker(n,NodeFilter.SHOW_TEXT);for(;i.nextNode();){let s=i.currentNode;s.textContent&&/[^\x00-\x7F]/.test(s.textContent)&&e.push(s)}e.forEach(s=>{let o=document.createElement("span"),a="",r=!1,l="";for(let g of Array.from(s.textContent||"")){let f=g.codePointAt(0);f!==void 0&&f>127&&!t.has(g)?(r||(a+=S(l),l="",r=!0),l+=g):(r&&(a+=`<span class="non-ascii-highlight">${S(l)}</span>`,l="",r=!1),l+=g)}r?a+=`<span class="non-ascii-highlight">${S(l)}</span>`:a+=S(l),o.innerHTML=a,s.parentNode&&s.parentNode.replaceChild(o,s)})}var P=class extends d.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Highlight Non-ASCII"}),t.createEl("p",{text:"Highlights any character outside the standard ASCII range (0x00-0x7F) in both Edit Mode (Live Preview) and Reading View. Use the allowlist to exclude specific characters from highlighting.",cls:"setting-item-description"}),new d.Setting(t).setName("Enable highlighting").setDesc("Toggle non-ASCII character highlighting on or off.").addToggle(e=>e.setValue(this.plugin.settings.enabled).onChange(async i=>{this.plugin.settings.enabled=i,await this.plugin.saveSettings(),this.plugin.refreshAllEditors()})),new d.Setting(t).setName("Allowed characters").setDesc("Paste characters or emojis here that should NOT be highlighted. Just paste them next to each other, no separators needed. Example: e--n").addTextArea(e=>{e.setPlaceholder("e.g. e--n").setValue(this.plugin.settings.allowedChars).onChange(async i=>{this.plugin.settings.allowedChars=i,await this.plugin.saveSettings(),this.plugin.refreshAllEditors()}),e.inputEl.rows=3,e.inputEl.cols=40,e.inputEl.style.fontFamily="monospace"})}},E=class extends d.Plugin{async onload(){await this.loadSettings(),this.editorExtension=U(this),this.registerEditorExtension(this.editorExtension),this.registerMarkdownPostProcessor(t=>{if(this.settings.enabled){let e=C(this.settings.allowedChars);O(t,e)}}),this.addSettingTab(new P(this.app,this)),this.addCommand({id:"toggle-non-ascii-highlight",name:"Toggle non-ASCII highlighting",callback:async()=>{this.settings.enabled=!this.settings.enabled,await this.saveSettings(),this.refreshAllEditors()}})}async loadSettings(){this.settings=Object.assign({},R,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}refreshAllEditors(){this.app.workspace.iterateAllLeaves(t=>{let e=t.view;e!=null&&e.editor&&e.editor.cm instanceof c.EditorView&&e.editor.cm.dispatch({effects:[v.of(this.settings.enabled),y.of(this.settings.allowedChars)]})}),this.app.workspace.iterateAllLeaves(t=>{var i;let e=t.view;(i=e==null?void 0:e.previewMode)!=null&&i.rerender&&e.previewMode.rerender(!0)})}};
