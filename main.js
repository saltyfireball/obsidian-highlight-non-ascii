/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var y=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var B=(o,s)=>{for(var e in s)y(o,e,{get:s[e],enumerable:!0})},U=(o,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of I(s))!M.call(o,i)&&i!==e&&y(o,i,{get:()=>s[i],enumerable:!(t=L(s,i))||t.enumerable});return o};var O=o=>U(y({},"__esModule",{value:!0}),o);var Y={};B(Y,{default:()=>b});module.exports=O(Y);var r=require("obsidian"),d=require("@codemirror/view"),h=require("@codemirror/state"),N=`.non-ascii-highlight {
  background-color: rgba(255, 60, 60, 1);
  padding: 1px;
  border: 1px solid rgb(255, 255, 255);
  border-radius: 2px;
}`,R={enabled:!0,allowedChars:"",customCSS:N};function x(o){let s=new Set;for(let e of Array.from(o))e.trim()===""&&e!=="\xA0"||s.add(e);return s}function S(o){return o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var _="highlight-non-ascii",A=h.StateEffect.define(),F=h.StateEffect.define(),D=h.StateEffect.define();function j(o){let s=h.StateField.define({create(){return{enabled:o.settings.enabled,allowedSet:x(o.settings.allowedChars),frontmatterDisabled:o.isActiveFileDisabledByFrontmatter()}},update(t,i){let n=t;for(let a of i.effects)a.is(A)&&(n={...n,enabled:a.value}),a.is(F)&&(n={...n,allowedSet:x(a.value)}),a.is(D)&&(n={...n,frontmatterDisabled:a.value});return n}}),e=d.ViewPlugin.fromClass(class{constructor(t){this.decorations=this.buildDecorations(t)}update(t){(t.docChanged||t.viewportChanged||t.transactions.some(i=>i.effects.some(n=>n.is(A)||n.is(F)||n.is(D))))&&(this.decorations=this.buildDecorations(t.view))}buildDecorations(t){let{enabled:i,allowedSet:n,frontmatterDisabled:a}=t.state.field(s);if(!i||a)return d.Decoration.none;let l=new h.RangeSetBuilder,c=t.state.doc;for(let{from:g,to:f}of t.visibleRanges){let w=c.sliceString(g,f),E=0,u=g;for(let v of Array.from(w)){let p=v.length,P=v.codePointAt(0);if(P!==void 0&&P>127&&!n.has(v)){let m=u+p,V=Array.from(w.slice(E+p));for(let C of V){let k=C.codePointAt(0);if(k!==void 0&&k>127&&!n.has(C))m+=C.length;else break}l.add(u,m,d.Decoration.mark({class:"non-ascii-highlight"}));let H=m-u;E+=H,u=m;continue}E+=p,u+=p}}return l.finish()}},{decorations:t=>t.decorations});return[s,e]}function W(o,s){let e=[],t=document.createTreeWalker(o,NodeFilter.SHOW_TEXT);for(;t.nextNode();){let i=t.currentNode;i.textContent&&/[^\x00-\x7F]/.test(i.textContent)&&e.push(i)}e.forEach(i=>{let n=document.createElement("span"),a="",l=!1,c="";for(let g of Array.from(i.textContent||"")){let f=g.codePointAt(0);f!==void 0&&f>127&&!s.has(g)?(l||(a+=S(c),c="",l=!0),c+=g):(l&&(a+=`<span class="non-ascii-highlight">${S(c)}</span>`,c="",l=!1),c+=g)}l?a+=`<span class="non-ascii-highlight">${S(c)}</span>`:a+=S(c),n.innerHTML=a,i.parentNode&&i.parentNode.replaceChild(n,i)})}var T=class extends r.PluginSettingTab{constructor(s,e){super(s,e),this.plugin=e}display(){let{containerEl:s}=this;s.empty(),s.createEl("h2",{text:"Highlight Non-ASCII"}),s.createEl("p",{text:"Highlights any character outside the standard ASCII range (0x00-0x7F) in both Edit Mode (Live Preview) and Reading View. Use the allowlist to exclude specific characters from highlighting.",cls:"setting-item-description"});let e=s.createDiv("hna-frontmatter-hint");e.createEl("h3",{text:"Per-note control"}),e.createEl("p",{text:"You can disable highlighting for a specific note by adding the following to its frontmatter:"}),e.createEl("pre").createEl("code",{text:`---
highlight-non-ascii: false
---`}),e.createEl("p",{text:"If the property is missing or set to true, highlighting remains active (as long as the global toggle above is enabled).",cls:"setting-item-description"}),new r.Setting(s).setName("Enable highlighting").setDesc("Toggle non-ASCII character highlighting on or off.").addToggle(a=>a.setValue(this.plugin.settings.enabled).onChange(async l=>{this.plugin.settings.enabled=l,await this.plugin.saveSettings(),this.plugin.refreshAllEditors()})),new r.Setting(s).setName("Allowed characters").setDesc("Paste characters or emojis here that should NOT be highlighted. Just paste them next to each other, no separators needed. Example: e--n").addTextArea(a=>{a.setPlaceholder("e.g. e--n").setValue(this.plugin.settings.allowedChars).onChange(async l=>{this.plugin.settings.allowedChars=l,await this.plugin.saveSettings(),this.plugin.refreshAllEditors()}),a.inputEl.rows=3,a.inputEl.cols=40,a.inputEl.style.fontFamily="monospace"}),new r.Setting(s).setName("Custom CSS").setDesc("Override the default highlight style. Use the .non-ascii-highlight selector to customize background-color, border, padding, border-radius, etc.");let n=s.createDiv("hna-css-editor").createEl("textarea",{cls:"hna-css-textarea"});n.value=this.plugin.settings.customCSS||N,n.rows=8,n.spellcheck=!1,n.addEventListener("change",async()=>{this.plugin.settings.customCSS=n.value,await this.plugin.saveSettings(),this.plugin.updateCustomCSS()})}},b=class extends r.Plugin{constructor(){super(...arguments);this.customStyleEl=null}async onload(){await this.loadSettings(),this.customStyleEl=document.createElement("style"),this.customStyleEl.id="highlight-non-ascii-custom-css",document.head.appendChild(this.customStyleEl),this.updateCustomCSS(),this.editorExtension=j(this),this.registerEditorExtension(this.editorExtension),this.registerMarkdownPostProcessor((e,t)=>{if(!this.settings.enabled)return;if(t.sourcePath){let n=this.app.vault.getAbstractFileByPath(t.sourcePath);if(n instanceof r.TFile&&this.isFileDisabledByFrontmatter(n))return}let i=x(this.settings.allowedChars);W(e,i)}),this.addSettingTab(new T(this.app,this)),this.addCommand({id:"toggle-non-ascii-highlight",name:"Toggle non-ASCII highlighting",callback:async()=>{this.settings.enabled=!this.settings.enabled,await this.saveSettings(),this.refreshAllEditors()}}),this.registerEvent(this.app.metadataCache.on("changed",()=>{this.dispatchFrontmatterUpdate()})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.dispatchFrontmatterUpdate()}))}isFileDisabledByFrontmatter(e){var n;let t=this.app.metadataCache.getFileCache(e),i=(n=t==null?void 0:t.frontmatter)==null?void 0:n[_];return i===!1||i==="false"}isActiveFileDisabledByFrontmatter(){let e=this.app.workspace.getActiveViewOfType(r.MarkdownView);return e!=null&&e.file?this.isFileDisabledByFrontmatter(e.file):!1}dispatchFrontmatterUpdate(){let e=this.isActiveFileDisabledByFrontmatter();this.app.workspace.iterateAllLeaves(t=>{let i=t.view;i!=null&&i.editor&&i.editor.cm instanceof d.EditorView&&i.editor.cm.dispatch({effects:[D.of(e)]})})}onunload(){this.customStyleEl&&(this.customStyleEl.remove(),this.customStyleEl=null)}updateCustomCSS(){this.customStyleEl&&(this.customStyleEl.textContent=this.settings.customCSS||"")}async loadSettings(){this.settings=Object.assign({},R,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}refreshAllEditors(){this.app.workspace.iterateAllLeaves(e=>{let t=e.view;t!=null&&t.editor&&t.editor.cm instanceof d.EditorView&&t.editor.cm.dispatch({effects:[A.of(this.settings.enabled),F.of(this.settings.allowedChars)]})}),this.app.workspace.iterateAllLeaves(e=>{var i;let t=e.view;(i=t==null?void 0:t.previewMode)!=null&&i.rerender&&t.previewMode.rerender(!0)})}};
